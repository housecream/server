<html>

<script type="text/javascript" src="../fabric-0.9.15.min.js"></script>

<body>
  <canvas id="c" width="600" height="500"></canvas>
</body>

<script>
var canvas = new fabric.StaticCanvas('c');


var Cross = fabric.util.createClass(fabric.Object, {

  initialize: function(options) {
    this.callSuper('initialize', options);
    this.animDirection = 'up';

    this.width = 100;
    this.height = 100;

    this.w1 = this.h2 = 100;
    this.h1 = this.w2 = 30;
  },

  animateWidthHeight: function() {
    var interval = 2;

    if (this.h2 >= 30 && this.h2 <= 100) {
      var actualInterval = (this.animDirection === 'up' ? interval : -interval);
      this.h2 += actualInterval;
      this.w1 += actualInterval;
    }

    if (this.h2 >= 100) {
      this.animDirection = 'down';
      this.h2 -= interval;
      this.w1 -= interval;
    }
    if (this.h2 <= 30) {
      this.animDirection = 'up';
      this.h2 += interval;
      this.w1 += interval;
    }
  },

  _render: function(ctx) {
    ctx.fillRect(-this.w1 / 2, -this.h1 / 2, this.w1, this.h1);
    ctx.fillRect(-this.w2 / 2, -this.h2 / 2, this.w2, this.h2);
  }
});

canvas.add(
  new Cross({ top: 100, left: 100 }),
  new Cross({ top: 140, left: 230 }),
  new Cross({ top: 300, left: 210 }),
  new Cross({ top: 40, left: 400 }),
  new Cross({ top: 450, left: 400 })
);

var context = canvas.getContext();

fabric.Image.fromURL('plan.jpg', function(img) {

	  canvas.add(img.set({ left: img.width / 4, top: img.height / 4, angle: 0 }).scale(0.3));
// 	  img.on('moving', function() { positionBtn(img) });
// 	  positionBtn(img);
    canvas.add(new fabric.Rect({ top: 100, 
    	shadowColor: "#999",
    shadowBlur: 20,
    shadowOffsetX: 15,
    shadowOffsetY: 15,

    left: 100, 
    	width: 50, 
    	height: 50, 
    	fill: '#f55' }));
	});




setTimeout(function animate() {
  canvas.forEachObject(function(obj){ obj.animateWidthHeight() });
  canvas.renderAll();
  setTimeout(animate, 10);
}, 10);
</script>

</html>
