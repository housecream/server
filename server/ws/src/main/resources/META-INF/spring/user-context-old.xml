<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:oauth2="http://www.springframework.org/schema/security/oauth2" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:security="http://www.springframework.org/schema/security" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/security/oauth2 http://www.springframework.org/schema/security/spring-security-oauth2.xsd
        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd">



	<bean id="myPasswordEncoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder">
		<constructor-arg>
			<value>512</value>
		</constructor-arg>
	</bean>
	<bean id="saltSource" class="net.awired.ajsl.ws.resource.MixedSaltSource">
		<property name="source1">
			<bean class="org.springframework.security.authentication.dao.ReflectionSaltSource">
				<property name="userPropertyToUse">
					<value>id</value>
				</property>
			</bean>
		</property>
		<property name="source2">
			<bean class="org.springframework.security.authentication.dao.SystemWideSaltSource">
				<property name="systemWideSalt">
					<value>saltString</value>
				</property>
			</bean>
		</property>
	</bean>



	<security:authentication-manager alias="authenticationManager">
		<security:authentication-provider>
			<security:user-service id="userDetailsService">
				<security:user name="n0rad" password="password" authorities="ROLE_USER" />
			</security:user-service>
		</security:authentication-provider>
	</security:authentication-manager>



	<bean id="httpCodeAuthenticationHandler" class="net.awired.ajsl.security.HttpCodeAuthenticationHandler" />
    <bean id="restfulLoginFilter" class="net.awired.ajsl.security.RestfulLoginFilter">
        <property name="usernameParameter" value="username" />
        <property name="passwordParameter" value="password" />
        <property name="filterProcessesUrl" value="/ws/session"/>
        <property name="authenticationSuccessHandler" ref="httpCodeAuthenticationHandler"/>
        <property name="authenticationFailureHandler" ref="httpCodeAuthenticationHandler"/>
        <property name="authenticationManager" ref="authenticationManager"/>
    </bean>

	<bean id="restfulLogoutFilter" class="net.awired.ajsl.security.RestfulLogoutFilter">
		<constructor-arg index="0" ref="httpCodeAuthenticationHandler" />
		<constructor-arg index="1">
			<array>
				<bean class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler" />
			</array>
		</constructor-arg>
		<property name="filterProcessesUrl" value="/ws/session" />
	</bean>

    <bean id="loginUrlAuthenticationEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <constructor-arg index="0" value="/NONE"/>
    </bean>

	<security:http auto-config="false" entry-point-ref="loginUrlAuthenticationEntryPoint" authentication-manager-ref="authenticationManager" >
		<security:custom-filter ref="restfulLoginFilter" position="FORM_LOGIN_FILTER"/>	
		<security:custom-filter ref="restfulLogoutFilter" position="LOGOUT_FILTER" />        
		<security:anonymous />
	</security:http>


    <!-- <bean id="http403EntryPoint" class="org.springframework.security.web.authentication.Http403ForbiddenEntryPoint" /> -->

    <!-- <security:http pattern="/login**" use-expressions="true" entry-point-ref="http403EntryPoint"> -->
    <!-- <security:intercept-url pattern="/login**" access="permitAll" /> -->
    <!-- </security:http> -->

<!--        <security:logout success-handler-ref="httpCodeAuthenticationHandler" logout-url="/ws/session/logout" /> -->
<!--        <security:form-login login-processing-url="/ws/session" authentication-failure-handler-ref="httpCodeAuthenticationHandler" -->
<!--            password-parameter="password" username-parameter="username" authentication-success-handler-ref="httpCodeAuthenticationHandler" /> -->

</beans>